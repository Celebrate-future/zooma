var JAVASCRIPT="js",STYLESHEET="css",annotationSummarySuffix="_annotation_summary",propertyTypeSuffix="_property_type",propertyValueSuffix="_property_value",annotatesToSuffix="_annotates_to",annotationSummaryClass="zooma_annotation_summary",propertyTypeClass="zooma_property_type",propertyValueClass="zooma_property_value",annotatesToClass="zooma_annotates_to";
(function(a){a.fn.zooma=function(b){var d=a(this);log("Adding zooma functionality to "+d.attr("id"));b=a.extend({api_base_url:"http://www.ebi.ac.uk/fgpt/zooma/",api_base_path:"v2/api"},b);var e=a.extend({service_url:b.api_base_url,flyout_service_url:b.api_base_url+b.api_base_path,service_path:b.api_base_path+"/search",prefixed:!0,zIndex:10},b);log("ZOOMA settings loaded: initializing with the following configuration...");log(JSON.stringify(e));try{log("Creating placeholder divs to store selected annotation info");var c=this.attr("id")+"_zooma_results";d.after('<div id="'+c+'"></div>');a("#"+c).append('<div id="'+c+annotationSummarySuffix+'" class="'+annotationSummaryClass+'" />').append('<div id="'+c+propertyTypeSuffix+'" class="'+propertyTypeClass+'" />').append('<div id="'+c+propertyValueSuffix+'" class="'+propertyValueClass+'" />').append('<div id="'+c+annotatesToSuffix+'" class="'+annotatesToClass+'" />').hide();log("Binding suggest handling to "+d);d.suggest(e).bind("fb-select",function(b,g){onSelect(g,e,d,a("#"+c))});log("ZOOMA initialization complete!");return this}catch(f){throw log("ZOOMA initialization failed: "+f),"ZOOMA initialization failed: "+f;}}})(jQuery);
$(document).ready(function(){0==$("#zooma-log").length&&($("body").append('<div id="zooma-log" />'),$("#zooma-log").hide());try{loadLibraries([{location:"https://www.gstatic.com/freebase/suggest/3_1/suggest.min.js",type:JAVASCRIPT},{location:"https://www.gstatic.com/freebase/suggest/3_1/suggest.min.css",type:STYLESHEET}],function(){log("Finished loading all libraries")})}catch(a){log("Failed to load libraries: "+a)}});
function onSelect(a,b,d,e){log("ZOOMA result '"+a.id+"' was selected, input element is "+d.attr("id"));var c=b.service_url+b.api_base_path+"/summaries/"+a.id;log("Attempting to get data from ZOOMA... CORS supported: "+$.support.cors+"; Summary ID: "+a.id+".");try{$.getJSON(c,function(a){log("Got ajax response...");log("Updating "+e.attr("id")+" with results");e.children("."+annotationSummaryClass).html(a.id);e.children("."+propertyTypeClass).html(a.annotatedPropertyType);e.children("."+propertyValueClass).html(a.annotatedPropertyValue);for(var c="",f=0;f>a.semanticTags.length-1;f++)c+=",";c+=a.semanticTags[a.semanticTags.length-1];e.children("."+annotatesToClass).html(c);if(b.onSelect){log("Invoking onSelect callback...");try{b.onSelect(a),log("onSelect callback function successfully called")}catch(h){log("onSelect callback failed: "+h)}}log("ZOOMA has finished sending results");return d.change()})}catch(f){log("AJAX request for "+a.id+" failed: "+f)}}
function loadLibraries(a,b){log("Trying to load "+a.length+" libraries...");1<a.length?loadLibrary(a[0].location,a[0].type,function(){loadLibraries(a.slice(1),b)}):loadLibrary(a[0].location,a[0].type,b)}function loadLibrary(a,b,d){log("Loading "+b+" library from "+a+"...");if(b==JAVASCRIPT)log("Attempting load of javascript library..."),$.getScript(a,d).done(function(b,c){log("Loaded javascript library from "+a+": "+c)}).fail(function(b,c,f){log("Failed to load javascript library from "+a+": "+f);d()});else if(b==STYLESHEET)log("Attempting load of cascading style sheet library..."),$("head").append("<link>"),css=$("head").children(":last"),css.attr({rel:"stylesheet",type:"text/css",href:a}),d();else throw"Unknown library type: "+b+"; Failed to load from "+a;}function log(a){$("#zooma-log").append('<div class="logmessage">'+a+"</div>")};